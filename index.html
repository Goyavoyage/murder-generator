<!DOCTYPE html>
<html xmlns = "http://www.w3.org/1999/xhtml" lang = "">
  <head>
    <meta charset="utf-8" />
    <title>Murder generator</title>
    <link rel = "stylesheet" type = "text/css" href = "web/styles.css" />
    <link rel = "icon" type = "image/svg+xml" href = "web/favicon.svg" sizes = "any" />
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0" />
  </head>
  <body>

    <div id = "response"></div>

    <svg version = "1.1" baseProfile = "tiny" width = "100" height = "100" xmlns="http://www.w3.org/2000/svg" class = "loading">
      <g id = "loading-global-transform" transform = "scale(1, 1)">
        <g transform = "translate(50, 50)">
          <g transform = "translate(-50, -50)">
            <circle cx = "50" cy = "50" r = "50" fill = "#75507b" />
            <path d = "M 50,20 A 30 30 0 0 1 80,50" fill = "none" stroke = "#ad7fa8" stroke-width = "5px" />
            <animateTransform attributeType = "xml" attributeName = "transform" type = "rotate" from = "0 50 50" to = "360 50 50" dur = "2s" additive = "sum" repeatCount = "indefinite" />
          </g>
          <animateTransform id = "loading-animation" attributeType = "xml" attributeName = "transform" type = "scale" additive = "sum" from = "0 0" to = "1 1" begin = "0s" dur = ".3s" repeatCount = "1" />
        </g>
      </g>
    </svg>

    <script>
      /* @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-v3-or-Later */

      var loadingAnimation = document.getElementById ("loading-animation")
      var loadingGlobalTransform = document.getElementById ("loading-global-transform")
      var responseDiv = document.getElementById ("responseDiv")

      function isLoading (){
        return (loadingAnimation.getAttribute ("to")[0] === "1")
      }

      function startLoading (){
        if (isLoading ()) return

        var startValue = la.animVal
        if (startValue === undefined || !isLoading ()) startValue = "0 0"
        loadingAnimation.removeAttribute ("values")
        loadingAnimation.removeAttribute ("keyTimes")
        loadingAnimation.setAttribute ("dur", "1s")
        loadingAnimation.setAttribute ("from", startValue)
        loadingAnimation.setAttribute ("to", "1 1")
        loadingGlobalTransform.setAttribute ("transform", "scale(1, 1)")
        la.beginElement ()
      }

      function stopLoading (){
        if (!isLoading ()) return

        var startValue = loadingAnimation.animVal
        if (startValue === undefined || isLoading ()) startValue = "1 1"
        loadingAnimation.setAttribute ("dur", "1s")
        loadingAnimation.setAttribute ("from", startValue)
        loadingAnimation.setAttribute ("to", "0 0")
        loadingAnimation.setAttribute ("values", startValue + ";0 0;0 0")
        loadingAnimation.setAttribute ("keyTimes", "0;0.3;1")
        setTimeout (function () { loadingGlobalTransform.setAttribute ("transform", "scale(0, 0)") }, 300)
        loadingAnimation.beginElement ()
      }

      function error (e){
        stopLoading ()

        var p = document.createElement ("p")
        response.appendChild (p)
        p.appendChild (document.createTextNode ("An error occurred! "))
        var a = document.createElement ("a")
        a.setAttribute ("href", "https://github.com/Mbodin/murder-generator/issues")
        a.appendChild (document.createTextNode ("Please report it."))
        p.appendChild (a)
        p.appendChild (document.createTextNode (" Error details: " + e))
      }

      (function (){
        startLoading ()

        var request = new XMLHttpRequest()
        request.open ("GET", "web/main.js")
        request.onerror = function (){
            error ("An error occurred when fetching the main script.")
          }
        request.onload = function (){
            if (request.status != 200){
              error (request.status + ": " + request.statusText)
            } else {
              try {
                eval (request.responseText)
              } catch (e){
                error (e)
              }
            }
          }
        request.send ()
      }) ()
      /* @license-end */
    </script>
  </body>
</html>

